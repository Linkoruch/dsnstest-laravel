# ВИПРАВЛЕННЯ: Поле attempts_limit не зберігалось у базі

## Проблема
При створенні тесту з кількістю спроб (наприклад 1), значення не зберігалось у базі даних. 
DEBUG показував: `limit=NULL | remaining=9223372036854775807 | PHP_INT_MAX=YES`

## Причина
Поле `attempts_limit` **НЕ БУЛО ДОДАНО** до масиву `$fillable` у моделі `Test`.

Коли поле не вказане у `$fillable`, Laravel блокує його збереження через механізм Mass Assignment Protection.

## Рішення

### 1. Додано attempts_limit до $fillable

**Файл:** `app/Models/Test.php`

**Було:**
```php
protected $fillable = [
    'name',
    'description',
    'questions_file_path',
    'risk_levels',
];
```

**Стало:**
```php
protected $fillable = [
    'name',
    'description',
    'questions_file_path',
    'risk_levels',
    'attempts_limit', // ✅ ДОДАНО
];
```

### 2. Додано attempts_limit до casts

**Файл:** `app/Models/Test.php`

**Було:**
```php
protected function casts(): array
{
    return [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
        'risk_levels' => 'array',
    ];
}
```

**Стало:**
```php
protected function casts(): array
{
    return [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
        'risk_levels' => 'array',
        'attempts_limit' => 'integer', // ✅ ДОДАНО
    ];
}
```

### 3. Видалено DEBUG інформацію з view

Прибрано тимчасову діагностичну інформацію, додано інформативний заголовок:
- Показує "Базовий ліміт: X спроб" якщо ліміт встановлено
- Показує "Необмежена кількість спроб" якщо ліміту немає

## Як працює тепер

### Крок 1: Створення тесту
1. Відкрийте створення тесту
2. Вкажіть "Кількість спроб: 1"
3. Натисніть "Створити тест"
4. ✅ Значення **ЗБЕРІГАЄТЬСЯ** у базі даних

### Крок 2: Редагування тесту
1. Відкрийте редагування тесту
2. Поле показує збережене значення: "1"
3. Можете змінити на інше число
4. ✅ Зміни **ЗБЕРІГАЮТЬСЯ**

### Крок 3: Управління спробами
1. Відкрийте управління спробами
2. У заголовку: "Базовий ліміт: 1 спроб"
3. У таблиці: "Залишилось: 1" ✅
4. Більше НЕ показує "Необмежено"

## Приклади

### Тест з 1 спробою
```
Заголовок: Базовий ліміт: 1 спроб

Таблиця:
┌─────────────┬──────────────┬─────────────┐
│ Користувач  │ Використано  │ Залишилось  │
├─────────────┼──────────────┼─────────────┤
│ Іван        │      0       │      1      │ ✅
└─────────────┴──────────────┴─────────────┘
```

### Тест з 5 спробами (пройдено 2 рази)
```
Заголовок: Базовий ліміт: 5 спроб

Таблиця:
┌─────────────┬──────────────┬─────────────┐
│ Користувач  │ Використано  │ Залишилось  │
├─────────────┼──────────────┼─────────────┤
│ Петро       │      2       │      3      │ ✅
└─────────────┴──────────────┴─────────────┘
```

### Тест без обмежень
```
Заголовок: Необмежена кількість спроб

Таблиця:
┌─────────────┬──────────────┬─────────────┐
│ Користувач  │ Використано  │ Залишилось  │
├─────────────┼──────────────┼─────────────┤
│ Марія       │     10       │ Необмежено  │ ✅
└─────────────┴──────────────┴─────────────┘
```

## Важливо!

### Для існуючих тестів
Якщо у вас вже є тести, створені до цього виправлення, вони мають `attempts_limit = NULL`.

**Що зробити:**
1. Відкрийте редагування тесту
2. Вкажіть потрібну кількість спроб
3. Збережіть
4. ✅ Тепер значення збереглося!

### Для нових тестів
Все працює автоматично - просто вказуйте кількість спроб при створенні.

## Що було зроблено

1. ✅ Додано `attempts_limit` до `$fillable` у моделі Test
2. ✅ Додано `attempts_limit` до `casts` як integer
3. ✅ Видалено DEBUG інформацію з view
4. ✅ Додано інформативний заголовок про ліміт
5. ✅ Очищено всі кеші

## Перевірка

### Тест 1: Створення ✅
```
1. Створити тест з attempts_limit = 3
2. Зберегти
3. Перейти на управління спробами
4. Перевірити: показує "Базовий ліміт: 3 спроби"
5. Перевірити таблицю: "Залишилось: 3"
```

### Тест 2: Редагування ✅
```
1. Відкрити редагування тесту
2. Поле показує: "3"
3. Змінити на: "5"
4. Зберегти
5. Управління спробами: "Базовий ліміт: 5 спроб"
```

### Тест 3: Після використання ✅
```
1. Користувач пройшов тест (1/3)
2. Управління спробами: "Залишилось: 2"
```

## Результат

✅ **Проблему повністю вирішено!**

Тепер:
- Кількість спроб **зберігається** у базі даних
- Правильно **відображається** на всіх сторінках
- **Збереженє значення** при редагуванні тесту
- **Коректно розраховується** залишок спроб

🎉 Система управління спробами працює ідеально!

