# Діагностика проблеми з відображенням спроб

## Проблема
Після всіх виправлень все ще показує "Необмежено" замість конкретної кількості спроб.

## Додано DEBUG інформацію

### У заголовку сторінки:
```
DEBUG: attempts_limit = "значення" | Type: тип | IsNull: YES/NO
```

### Біля кожного користувача:
```
DEBUG: limit=значення | remaining=значення | PHP_INT_MAX=YES/NO
```

## Що перевірити

### 1. Перевірте значення attempts_limit
На сторінці `/tests/{id}/manage-attempts` подивіться DEBUG інформацію у заголовку:

**Якщо показує:**
- `attempts_limit = ""` і `IsNull: YES` → Поле NULL у базі
- `attempts_limit = "1"` і `IsNull: NO` → Поле має значення 1
- `attempts_limit = "0"` → Можливо збереглося 0 замість NULL

### 2. Перевірте remaining
У таблиці біля кожного користувача:

**Якщо показує:**
- `remaining=9223372036854775807` і `PHP_INT_MAX=YES` → Система вважає це необмеженим
- `remaining=1` і `PHP_INT_MAX=NO` → Правильне значення, але щось не так з умовою

### 3. Перевірте чи зберігається значення при створенні/редагуванні

**Тест:**
1. Створіть новий тест з `attempts_limit = 2`
2. Збережіть
3. Перейдіть на управління спробами
4. Подивіться DEBUG значення

## Можливі причини

### Причина A: Поле не зберігається
Якщо `attempts_limit = ""` і `IsNull: YES`:
- Міграція не виконалась
- Поле не додане до fillable у моделі Test
- Проблема з валідацією при збереженні

### Причина B: Зберігається 0 або ""
Якщо `attempts_limit = "0"` або порожній рядок:
- HTML форма надсилає порожній рядок замість NULL
- Потрібно конвертувати порожні значення в NULL

### Причина C: Проблема з розрахунком
Якщо limit правильний, але remaining неправильний:
- Проблема в методі getRemainingAttempts()
- Проблема з завантаженням зв'язку test

## Наступні кроки

Після перегляду DEBUG інформації:

### Якщо attempts_limit = NULL або "":
1. Перевірити чи міграція виконалась
2. Перевірити fillable у моделі Test
3. Додати обробку порожніх значень у компонентах

### Якщо attempts_limit має значення, але показує "Необмежено":
1. Перевірити метод getRemainingAttempts()
2. Перевірити умову у view
3. Перевірити чи завантажується зв'язок test

### Якщо remaining = PHP_INT_MAX коли не повинно:
1. Проблема в методі getTotalAvailableAttempts()
2. Можливо $this->test не завантажено

## Тимчасове рішення

Якщо проблема у порожніх рядках замість NULL, додати до компонентів:

```php
// У CreateTest та EditTest, перед save/update:
if ($this->attempts_limit === '' || $this->attempts_limit === '0') {
    $this->attempts_limit = null;
}
```

## Очікувані значення DEBUG

### Для тесту з 1 спробою:
```
DEBUG: attempts_limit = "1" | Type: integer | IsNull: NO
DEBUG: limit=1 | remaining=1 | PHP_INT_MAX=NO
```

### Для тесту без обмежень:
```
DEBUG: attempts_limit = "" | Type: NULL | IsNull: YES
DEBUG: limit=NULL | remaining=9223372036854775807 | PHP_INT_MAX=YES
```

## Інструкція

1. Відкрийте сторінку управління спробами
2. Зробіть скриншот або скопіюйте DEBUG інформацію
3. Повідомте результати
4. На основі цього можна буде точно визначити проблему і виправити

